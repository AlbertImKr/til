# Command

## 💡 대표적인 명령어

| docker 명령 | 상위 커맨드    | 하위 커맨드 | 옵션 |
| --------- | --------- | ------ | -- |
| docker    | container | start  | -a |
| -i        |           |        |    |
|           |           | stop   | -t |
|           |           | create | -a |
| -e        |           |        |    |
| -i        |           |        |    |
| -p        |           |        |    |
| -v        |           |        |    |
| ……        |           |        |    |
|           |           | run    | -d |
| -e        |           |        |    |
| -i        |           |        |    |
| -t        |           |        |    |
| -p        |           |        |    |
| -v        |           |        |    |
| ……        |           |        |    |
|           |           | exec   |    |
|           |           | ……     |    |
|           | image     | pull   |    |
|           |           | search |    |
|           |           | ……     |    |
|           | volume    | create |    |
|           |           | rm     |    |
|           |           | ……     |    |
|           | network   | create |    |
|           |           | rm     |    |
|           |           | ……     |    |

## 💡 컨테이너 조작 관련 커맨드(상위 커맨드 container)

| 하위 커맨드                  | 내용                                                                                                                                  | 생략 가능 여부  | 주요 옵션          |
| ----------------------- | ----------------------------------------------------------------------------------------------------------------------------------- | --------- | -------------- |
| start                   | 컨테이너를 실행                                                                                                                            | O         | -i             |
| stop                    | 컨테이너를 정지                                                                                                                            | O         | 거의 사용하지 않음     |
| create                  | 도커 이미지로부터 컨테이너를 생성                                                                                                                  | O         | —name          |
| -e                      |                                                                                                                                     |           |                |
| -p                      |                                                                                                                                     |           |                |
| -v                      |                                                                                                                                     |           |                |
| run                     | 도커 이미지를 내려받고 컨테이너를 생성해 실행함(다운로드는 필요한 경우에만),docker image pull,docker container create,docker contianer start 라는 세개의 명령을 하나로 합친 것과 같다 | O         | —name 컨테이너\_이름 |
| 컨테이너 이름을 지정함            |                                                                                                                                     |           |                |
| -e 환경변수\_이름=값           |                                                                                                                                     |           |                |
| 환경변수를 설정함               |                                                                                                                                     |           |                |
| -p 호스트\_포트번호:컨테이너\_포트번호 |                                                                                                                                     |           |                |
| 포트 번호를 지정함              |                                                                                                                                     |           |                |
| -v 호스트\_디스크:컨테이너\_디렉터리  |                                                                                                                                     |           |                |
| 볼륨을 마운트함                |                                                                                                                                     |           |                |
| —net=네트워크\_이름           |                                                                                                                                     |           |                |
| 컨테이너를 네트워크에 연결함         |                                                                                                                                     |           |                |
| -d                      |                                                                                                                                     |           |                |
| 백그라운드로 실행함              |                                                                                                                                     |           |                |
| -i                      |                                                                                                                                     |           |                |
| 컨테이너에 터미널(키보드)을 연결함     |                                                                                                                                     |           |                |
| -t                      |                                                                                                                                     |           |                |
| 특수 키를 사용 가능하도록 함        |                                                                                                                                     |           |                |
| -help                   |                                                                                                                                     |           |                |
| 사용 방법 안내 메시지를 출력함       |                                                                                                                                     |           |                |
| rm                      | 정지 상태의 컨테이너를 삭제                                                                                                                     | O         | -f             |
| -v                      |                                                                                                                                     |           |                |
| exec                    | 실행 중인 컨테이너 속에서 프로그램을 실행                                                                                                             | O         | -i             |
| -t                      |                                                                                                                                     |           |                |
| ls                      | 컨테이너 목록을 출력                                                                                                                         | docker ps | -a             |
| cp                      | 도커 컨테이너와 도커 호스트 간에 파일을 복사                                                                                                           | O         | 거의 사용하지 않음     |
| commit                  | 도커 컨테이너를 이미지로 변환                                                                                                                    | O         | 거의 사용하지 않음     |

## 💡 이미지 조작 관련 커맨드(상위 커맨드 image)

| 하위 커맨드 | 내용                         | 생략 가능 여부   | 주요 옵션      |
| ------ | -------------------------- | ---------- | ---------- |
| pull   | 도커 허브 등의 리포지토리에서 이미지를 내려받음 | O          | 거의 사용하지 않음 |
| rm     | 도커 이미지를 삭제                 | docker rmi | 거의 사용하지 않음 |
| ls     | 내려 받은 이미지의 목록을 출력          | X          | 거의 사용하지 않음 |
| build  | 도커 이미지를 생성                 | O          | -t         |

## 💡 볼륨 조작 관련 커맨드(상위 커맨드 volume)

| 하위 커맨드  | 내용                    | 생략 가능 여부 | 주요 옵션      |
| ------- | --------------------- | -------- | ---------- |
| create  | 볼륨을 생성                | X        | —name      |
| inspect | 볼륨의 상세 정보를 출력         | X        | 거의 사용하지 않음 |
| ls      | 볼륨의 목록을 출력            | X        | -a         |
| prune   | 현재 마운트되지 않은 볼륨을 모두 삭제 | X        | 거의 사용하지 않음 |
| rm      | 지정한 볼륨을 삭제            | X        | 거의 사용하지 않음 |

## 💡 네트워크 조작 관련 커맨드(상위 커맨드 network)

| 하위 커맨드     | 내용                           | 생략 가능 여부 | 주요 옵션      |
| ---------- | ---------------------------- | -------- | ---------- |
| connect    | 컨테이너를 도커 네트워크에 연결            | X        | 거의 사용하지 않음 |
| disconnect | 컨테이너의 도커 네트워크 연결을 해제         | X        | 거의 사용하지 않음 |
| create     | 도커 네트워크를 생성                  | X        | 거의 사용하지 않음 |
| inspect    | 도커 네트워크의 상세 정보를 출력           | X        | 거의 사용하지 않음 |
| ls         | 도커 네트워크의 목록을 출력              | X        | 거의 사용하지 않음 |
| prune      | 현재 컨테이너가 접속하지 않은 네트워크를 모두 삭제 | X        | 거의 사용하지 않음 |
| rm         | 지정한 네트워크를 삭제                 | X        | 거의 사용하지 않음 |

## 💡 그 밖의 상위 커맨드

| 상위 커맨드     | 내용                                                     |
| ---------- | ------------------------------------------------------ |
| checkpoint | 현재 상태를 일시적으로 저장한 후, 나중에 해당 시점의 상태로 되돌릴 수 있다, 현재 실험적 기능 |
| node       | 도커 스웜의 노드를 관리하는 기능                                     |
| plugin     | 플러그인을 관리하는 기능                                          |
| secret     | 도커 스웜의 비밀값 정보를 관리하는 기능                                 |
| service    | 도커 스윔의 서비스를 관리하는 기능                                    |
| stack      | 도커 스웜 또는 쿠버네티스에서 여러 개의 서비스를 합쳐 구성한 스택을 관리하는 기능         |
| swarm      | 도커 스윔을 관리하는 기능                                         |
| system     | 도커 엔진의 정보를 확인하는 기능                                     |

## 💡 단독으로 쓰이는 커맨드

| 단독 커맨드  | 내용                     | 주요 옵션      |
| ------- | ---------------------- | ---------- |
| login   | 도커 레지스트리에 로그인          | -u         |
| -p      |                        |            |
| logout  | 도커 레지스트리에 로그아웃         | 거의 사용하지 않음 |
| search  | 도커 레지스트리를 검색           | 거의 사용하지 않음 |
| version | 도커 엔진 및 명령행 도구의 버번을 출력 | 거의 사용하지 않음 |

## 💡 도커 네트워크 관련 커맨드

| 커맨드        | 내용                              | 생략 기능 여부 | 주요 옵션      |
| ---------- | ------------------------------- | -------- | ---------- |
| connect    | 네트워크에 컨테이너를 새로이 접속              | X        | 거의 사용하지 않음 |
| disconnect | 네트워크에서 컨테이너의 접속을 끊음             | X        | 거의 사용하지 않음 |
| create     | 네트워크를 생성                        | X        | 거의 사용하지 않음 |
| inspect    | 네트워크의 상세 정보를 확인                 | X        | 거의 사용하지 않음 |
| ls         | 네트워크의 목록을 확인                    | X        | 거의 사용하지 않음 |
| prune      | 현재 아무 컨테이너도 접속하지 않은 네트워크를 모두 삭제 | X        | 거의 사용하지 않음 |
| rm         | 지정한 네트워크를 삭제                    | X        | 거의 사용하지 않음 |

## 💡 MySQL 컨테이너 실행 시 옵션

| 항목              | 옵션                       | 실습에서 사용하는 값      |
| --------------- | ------------------------ | ---------------- |
| 네트워크 이름         | —net                     | wordpress000net1 |
| MySQL 컨테이너 이름   | —name                    | mysql000ex11     |
| 실행 옵션           | -dit                     | 없음               |
| MySQL 루트 패스워드   | -e MYSQL\_ROOT\_PASSWORD | myrootpass       |
| MySQL 데이터베이스 이름 | -e MYSQL\_DATABASE       | wordpress000db   |
| MySQL 사용자 이름    | -e MYSQL\_USER           | wordpress000kun  |
| MySQL 패스워드      | -e MYSQL\_PASSWORD       | wkunpass         |

## 💡 MySQL 인자

| 항목     | 인자                             | 값                       | 의미                        |
| ------ | ------------------------------ | ----------------------- | ------------------------- |
| 문자 인코딩 | —character-set-server=         | utf8mb4                 | 문자 인코딩으로 UTF8을 사용         |
| 정렬 순서  | —collation-server=             | utf8mb4\_unicode\_ci    | 정렬 순서로 UTF8을 따름           |
| 인증 방식  | —default-authentication-plugin | mysql\_native\_password | 인증 방식을 예전 방식(native)으로 변경 |

## 💡 워드프레스 컨테이너 실행시 옵션

| 항목             | 옵션                         | 설정값(임의의 이름 또는 지정된 값) |
| -------------- | -------------------------- | -------------------- |
| 네트워크 이름        | —net                       | wordpress000net1     |
| 워드프레스 컨테이너 이름  | —name                      | wordpress000ex12     |
| 실행 옵션          | -dit                       | 없음                   |
| 포트 번호 설정       | -p                         | 8085:80              |
| 데이터베이스 컨테이너 이름 | -e WORDPRESS\_DB\_HOST     | mysql000ex11         |
| 데이터베이스 이름      | -e WORDPRESS\_DB\_NAME     | wordpress000db       |
| 데이터베이스 사용자 이름  | -e WORDPRESS\_DB\_USER     | wordpress000kun      |
| 데이터베이스 패스워드    | -e WORDPRESS\_DB\_PASSWORD | wkunpass             |

## 💡 파일 복사 커맨드 docker cp (docker container cp)

| 명령어                                 | 설명                                  |
| ----------------------------------- | ----------------------------------- |
| docker cp 호스트\_경로 컨테이너\_이름:컨테이너\_종료 | 컨테이너로 파일을 복사하는 커맨드 사용 예(호스트 → 컨테이너) |
| docker cp 컨테이너\_이름:컨테이너\_경로 호스트\_경로 | 호스트로 파일을 복사하는 커맨드 사용 예(컨테이너 → 호스트)  |
| docker cp 원본\_경로 복사할\_경로            | 파일 복수 명려어                           |

## 💡 볼륨의 주요 하위 컨맨드

| 커맨드     | 내용                    | 생략형 | 주요 옵션      |
| ------- | --------------------- | --- | ---------- |
| create  | 볼륨을 생성                | X   | 거의 사용하지 않음 |
| inspect | 볼륨의 상세 정보를 출력         | X   | 거의 사용하지 않음 |
| ls      | 볼륨의 목록을 출력            | X   | 거의 사용하지 않음 |
| prune   | 현재 마운트되지 않은 볼륨을 모두 삭제 | X   | 거의 사용하지 않음 |
| rm      | 지정한 볼륨을 삭제            | X   | 거의 사용하지 않음 |

* \-v 옵션 뒤에 ‘스토리지 실제 경로’ 또는 ‘볼륨 이름’,’컨테이너 마운트 경로’ 순서대로 기재한다. 이들경로는 콜론(:)을 사용해 구분한다.

## 💡 이미지를 만드는 방법

| 커맨드                                     | 설명                        |
| --------------------------------------- | ------------------------- |
| docker commit 컨테이너\_이름 새로운\_이미지\_이름     | commit 커맨드로 컨테이너를 이미지로 변환 |
| docker build -t 생성할\_이미지\_이름 재료\_플더\_경로 | Dockerfile 스크립트로 이미지 만들기  |

## 💡 주요 Dockerfile 인스트럭션

| 인스트럭션       | 내용                                                       |
| ----------- | -------------------------------------------------------- |
| FROM        | 토대가 되는 이미지를 지정                                           |
| ADD         | 이미지에 파일이나 플더를 추가                                         |
| COPY        | 이미지에 파일이나 플더를 추가                                         |
| RUN         | 이미지를 빌드할 때 실행할 명령어를 지정                                   |
| CMD         | 컨테이너를 실행할 때 실행할 명령어를 지정                                  |
| ENTRYPOINT  | 컨테이너를 실핼할 때 실행할 명령어를 강제 지정                               |
| ONBUILD     | 이 이미지를 기반으로 다른 이미지를 빌드할 때 실행할 명령어 지정                     |
| EXPOSE      | 이미지가 통신에 사용할 포트를 명시적으로 지정                                |
| VOLUME      | 퍼시스턴시 데이터를 저장할 경로를 명시적으로 지정                              |
| ENV         | 환경변수를 정의                                                 |
| WORKDIR     | RUN,CMD,ENTRYPOINT,ADD,COPY에 정의된 명령어를 실행하는 작업 디렉터리를 지정   |
| SHELL       | 빌드 시 사용할 셀을 변경                                           |
| LABEL       | 이름이나 버전, 저작자 정보를 설정                                      |
| USER        | RUN,CMD,ENTRYPOINT에 정의된 명령어를 실행하는 사용자 또는 그룹을 지정          |
| ARG         | docker build 커맨드를 사용할 때 입력받을 수 있는 인자를 선언                 |
| STOPSIGNAL  | docker stop 커맨드를 사용할 때 컨테이너 안에서 실행 중인 프로그램에 전달되는 시그널을 변경 |
| HEALTHCHECK | 컨테이너 헬스체크 방법을 커스터마이징                                     |

## 💡 bash 사용

| 커맨드                                 | 설명          |
| ----------------------------------- | ----------- |
| docker exec (옵션) 컨테이너\_이름 /bin/bash |             |
| docker run (옵션) 이미지\_이름 /bin/bash   | 잘 사용하지 않는다. |

## 💡 이미지 태크

| 커맨드                                           | 설명                    |
| --------------------------------------------- | --------------------- |
| docker tag 원래\_이미지\_이름 레지스트리\_주소/리포지토리\_이름:버전 | 이미지에 태그를 부여해 복제하는 명령어 |

## 💡 레지스트리 업로드

| 커맨드                                | 설명                  |
| ---------------------------------- | ------------------- |
| docker push 레지스트리\_주소/리포지토리\_이름:버전 | 레지스트리에 업로드하는 명령어의 예 |

## 💡 local에서 레지스트리를 만드는 명령어

| 커맨드                                 | 설명                  |
| ----------------------------------- | ------------------- |
| docker run -d -p 5000:5000 registry | local에서 레지스트리를 만든다. |

## 💡 docker-compose.yml

| 정의 파일의 형식  | YAML 형식            |
| ---------- | ------------------ |
| 파일 이름      | docker-compose.yml |
| version:   | 버전 기재              |
| services:  | 컨테이너 관련 정보         |
| networkds: | 네트워크 관련 정보         |
| volumes:   | 볼륨 관련 정보           |

## 💡 자주사용하는 컴포즈 정의 내용

| 항목          | docker run 커맨드의 해당 옵션 또는 인자 | 내용                   |
| ----------- | --------------------------- | -------------------- |
| image       | 이미지 인자                      | 사용할 이미지를 지정          |
| networks    | —net                        | 접속할 네트워크를 지정         |
| volumes     | -v, —mount                  | 스토리지 마운트를 설정         |
| ports       | -p                          | 포트 설정                |
| environment | -e                          | 환경변수 설정              |
| depends\_on | 없음                          | 다른 서비스에 대한 의존관계를 정의  |
| restart     | 없음                          | 컨테이너 종료 시 재시작 여부를 설정 |

## 💡 컴포즈 restart의 설정값

| 설정값            | 내용                          |
| -------------- | --------------------------- |
| no             | 재시작하지 않는다.                  |
| always         | 항상 재시작한다                    |
| on-failure     | 프로세스가 0 외의 상태로 종료됐다면 재시작한다. |
| unless-stopped | 종료 시 재시작하지 않음, 그 외에는 재시작한다. |

## 💡 컴포즈 커맨드

```bash
컨테이너와 주변 환경을 생성하는 docker-compose up 커맨드
docker-compose -f 정의_파일_경로 up 옵션
```

| UP옵션                     | 내용                             |
| ------------------------ | ------------------------------ |
| -d                       | 백그라운드로 실행                      |
| —no-color                | 화면 출력 내용을 흑백으로 함               |
| —no-deps                 | 링크된 서비스를 실행하지 않음               |
| —force-recreate          | 설정 또는 이미지가 변경되지 않더라도 컨테이너를 재생성 |
| —no-create               | 컨테이너가 이미 존재할 경우 다시 생성하지 않음     |
| —no-build                | 이미지가 없어도 이미지를 빌드하지 않음          |
| —build                   | 컨테이너를 실행하기 전에 이미지를 빌드          |
| —abort-on-container-exit | 컨테이너가 하나라도 종료되면 모든 컨테이너를 종료    |
| -t,—timeout              | 컨테이너를 종료할 때의 타임아웃 설정, 기본은 10초  |
| —remove-orphans          | 컴포즈 파일에 정의되지 않은 서비스의 컨테이너를 삭제  |
| —scale                   | 컨테이너의 수를 변경                    |

```bash
컨테이너와 네트워크를 삭제하는 docker-compose down 커맨드
docker-compose -f 컴포즈_파일_경로 down 옵션
```

| DOWN옵션          | 내용                                                                                  |
| --------------- | ----------------------------------------------------------------------------------- |
| —rmi 종류         | 삭제 시에 이미지도 삭제한다. 종류를 all로 지정하면 사용했던 모든 이미지가 삭제된다. local로 지정하면 커스텀 태그가 없는 이미지만 삭제한다. |
| -v, —volumes    | volumes 항목에 기재된 볼륨을 삭제한다. 단,external로 지정된 볼륨은 삭제되지 않는다.                             |
| —remove-orphans | 컴포즈 파일에 정의되지 않은 서비스의 컨테이너도 삭제한다.                                                    |

```bash
docker-compose -f 컴포즈_파일_경로 stop 옵션
```

| 커맨드     | 내용                           |
| ------- | ---------------------------- |
| up      | 컨테이너를 생성하고 실행한다.             |
| down    | 컨테이너와 네트워크를 종료하고 삭제한다.       |
| ps      | 컨테이너 목록을 출력한다.               |
| config  | 컴포즈 파일을 확인하고 내용을 출력한다.       |
| port    | 포트 설정 내용을 출력한다.              |
| logs    | 컨테이너가 출력한 내용을 화면에 출력한다.      |
| start   | 컨테이너를 시작한다.                  |
| stop    | 컨테이너를 종료한다.                  |
| kill    | 컨테이너를 강제 종료한다.               |
| exec    | 명령어를 실행한다.                   |
| run     | 컨테이너를 실행한다.                  |
| create  | 컨테이너를 생성한다.                  |
| restart | 컨테이너를 재실행한다.                 |
| pause   | 컨테이너를 일시 정지한다.               |
| unpause | 컨테이너의 일시 정지를 해제한다.           |
| rm      | 종료된 컨테이너를 삭제한다.              |
| build   | 컨테이너의 사용되는 이미지를 빌드 혹은 재빌드한다. |
| pull    | 컨테이너의 사용되는 이미지를 내려받는다.       |
| scale   | 컨테이너의 수를 지정한다.               |
| events  | 컨테이너로부터 실시간으로 이벤트를 수신한다.     |
| help    | 도움말 화면을 출력한다.                |
